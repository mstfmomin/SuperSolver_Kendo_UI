<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="apple-touch-icon" href="img/AppleIcon.png"/>
    <link rel="shortcut icon" href="img/favicon.ico" />
    <title>SuperSolver</title>
    
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="cordova_plugins.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/supersolver.js"></script>
    
    <link href="css/App.css" rel="stylesheet" type="text/css" />
    <link href="css/Customer.css" rel="stylesheet" type="text/css" />

    <script src="js/Core/Core.All.js" type="text/javascript"></script>    
    <script src="js/App.js" type="text/javascript"></script>
    <script src="js/Customer.js" type="text/javascript"></script>
    <script src="js/twitter.js" type="text/javascript"></script>
    <script src="js/jsOAuth.js" type="text/javascript"></script>
    <script src="js/fbauth.js" type="text/javascript"></script>
    <script src="cdv-plugin-fb-connect.js"></script>
    <script src="facebook-js-sdk.js"></script>

    <script type="text/javascript">
    $(document).ready(function () {
        console.log("Login Doc Ready");

        document.addEventListener("deviceready", DeviceReady, false);

        function DeviceReady()
        {
            console.log("Entering app.html DeviceReady");
            SuperSolver.Login.Init();
            FB.init({ appId: SuperSolver.FB_ID, nativeInterface: CDV.FB, useCachedDialogs: false });
            //FB.getLoginStatus(handleStatusChange); //don't think I need
            authUser(); //Facebook check
        }

        document.getElementById("MenuName").innerHTML=localStorage.CustomerName;


        $('#connectGG').on('click', function() {
            glogin.getCredentials();
        });

        $('#connectTW').on('click', function() {
            Twitter.init();
        });

        $('#connectFB').on('click', function() {
            promptLogin();
        });


        if (window.self === window.top) {
        } else {
            $($('form', '.SocialConnect')[1]).attr('target', '_top');
            $($('form', '.SocialConnect')[2]).attr('target', '_top');
        }

        if (localStorage.CustomerID > 0){
            document.getElementById("menuNotLoggedIn").style.display = "none";
            document.getElementById("menuLoggedIn").style.display = "block";

        }
        else
        {
            document.getElementById("menuNotLoggedIn").style.display = "block";
            document.getElementById("menuLoggedIn").style.display = "none";

        }

        document.getElementById("Email").value = localStorage.CustomerEmail;
        document.getElementById("Password").value = localStorage.CustomerPassword;

    });
</script>

        <!-- Kendo UI Mobile CSS -->
        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />

        <!-- jQuery JavaScript -->
        <script src="kendo/js/jquery.min.js"></script>
        <!-- Kendo UI Mobile combined JavaScript -->
        <script src="kendo/js/kendo.mobile.min.js"></script>
    
    
    
</head>
    <body>
        <script>
        // Initialize a new Kendo Mobile Application
            var app = new kendo.mobile.Application($(document.body), { skin: 'flat' });
            new kendo.mobile.Application($(document.body), { platform: "ios7"});
        </script>
    		<div id="Drawer3" data-role="drawer" data-layout="main-layout">
    			<div class="MenuView" id="MenuView">
    				<div class="MenuViewInner">
    					<div>
    						<div class="UserInfo">
    						<a href="javascript:;" class="MenuToggle">
    						<img alt="" src="img/Icons/LeftRound.png" /></a> <span id="MenuName"></span></div>
    						<ul class="MenuNav">
    						<li><a href="app.html">Start</a></li>
    						<li><a href="messages.html">Messages</a></li>
    						<li><a href="profile.html">Profile</a></li>
    						<li><a href="invitebusiness.html">Invite a Biz</a></li>
    						</ul>
    					</div>
    					<div>
    						<ul class="MenuNav" id="menuNotLoggedIn" style="display:none">
    						<li><a href="login.html">Login</a></li>
    						<li><a href="register.html">Register</a></li>
    						</ul>
    						<ul class="MenuNav" id="menuLoggedIn" style="display:none">
    						<li><a href="logout.html">Logout</a></li>
    						</ul>
    					</div>
    				</div>
    			</div>
        	</div> 		
           <!--Main layout of the pages including header and footer-->
            <div data-role="layout" data-id="main-layout">
              <div data-role="header">
                <div data-role="navbar">
                  <span data-role="view-title"></span>
                </div>
              </div>
                
              <div data-role="footer">
                <div data-role="tabstrip">
                  <a data-icon="action" href="#home">Login</a>
                  <a data-icon="share" href="#settings">Invite Biz</a>
                </div>
              </div>
            </div>
            
              
            
            
            
        <div class="Container" data-role="view" data-layout="main-layout" id="login" data-title="SuperSolver">

            <div class="MainView">
                <div class="Page" data-page="Login">

                    <div class="Content">
                        <div class="Login">
                            <h2>Login to <span class="Dull">SuperSolver</span></h2>
                            <p class="Info">
                                Enter your e-mail and password below to login to SuperSolver and read responses from businesses.
                            </p>
                            <div class="LoginForm">
                                <form method="post" id="LoginForm">
                                    <div class="FormRow">
                                        <label class="Label">E-Mail Address<span class="Astrix">*</span></label>
                                        <div class="FormElement">
                                            <input id="Email" name="Email" type="email" value="" />
                                            
                                        </div>
                                    </div>
                                    <div class="FormRow">
                                        <label class="Label">Password<span class="Astrix">*</span></label>
                                        <div class="FormElement">
                                            <input id="Password" name="Password" type="password" />
                                            
                                        </div>
                                    </div>
                                    <div class="FormRow">
                                        <div class="FormElement">
                                            <button type="submit" class="Btn GreenBtn">Login</button>
                                            <a href="forgotpassword.html" class="ForgotPwd">Forgot my Password</a>
                                        </div>
                                    </div>
                                    
                                </form>
                            </div>
                            <p>
                                OR Use your Facebook, Google or Twitter account to login.
                            </p>
                            <div class="SocialConnect">
                                <span>
                                    <input type="hidden" name="IsLogin" value="True" />
                                    <button class="GrayBtn" id="connectFB">
                                        <img alt="" src="img/Icons/FB_16.png" />
                                        Facebook</button>
                                </span>
                                <span>
                                    <input type="hidden" name="IsLogin" value="True" />
                                    <button class="GrayBtn" id="connectGG">
                                        <img alt="" src="img/Icons/GA_16.png" />
                                        Google</button>
                                </span>
                                <span>
                                    <input type="hidden" name="IsLogin" value="True" />
                                    <button class="GrayBtn" id="connectTW">
                                        <img alt="" src="img/Icons/TW_16.png" />
                                        Twitter</button>
                                </span>
                            </div>
                            <p>
                                Don't have a SuperSolver account? Tap <a href="register.html">here</a>
                                to join SuperSolver.
                            </p>
                        </div>
                    </div>
            	</div>



            </div>
        </div>
        
        <div class="LoadingWrapper" style="display:none;">
            <div class="Overlay"></div>
            <div class="Msg"></div>
        </div>
        <div id="DlgOverlay" style="display:none;"></div>

         <script type="text/javascript">
                //console.log("Adding login handler");
                //PhoneGap Login Handler
                var frm = $('#LoginForm');
                
                frm.submit(function(event){
                           $.ajax({
                                  type: frm.attr('method'),
                                  url: SuperSolver.theURL + "login2",
                                  data: frm.serialize(),
                                  //dataType: "jsonp",
                                  crossDomain: true,
                                  xhrFields:{
                                    withCredentials: true
                                  },
                                  success: function(data){
                                    if (data.Success === true){
                                        localStorage.LoginType = "1";
                                        localStorage.CustomerFirstName = data.CustomerFirstName;
                                        localStorage.CustomerLastName = data.CustomerLastName;
                                        localStorage.CustomerName = data.CustomerName;
                                        localStorage.CustomerID = data.CustomerID;
                                        localStorage.CustomerEmail = data.CustomerEmail;
                                        localStorage.CustomerPassword = document.getElementById("Password").value;
                                        localStorage.AuthTokenName = data.AuthTokenName;
                                        localStorage.AuthTokenValue = data.AuthTokenValue;
                                        localStorage.AuthTokenExpires = data.AuthTokenExpires;
                                        //var expires = "; expires=" + data.AuthTokenExpires;
                                        //document.cookie = data.AuthTokenName + "=" + data.AuthTokenValue + expires + "; path=/";
                                        console.log("Cookie Check: " + document.cookie);
                                        window.location.href = "app.html";
                                        //$.mobile.changePage('app.html');
                                    }
                                    else
                                    {
                                    navigator.notification.alert(data.ErrorText,null,"SuperSolver");
                                    }
                                  }
                                  });
                              event.preventDefault();
                           });

         </script>

     
     </body>
</html>
