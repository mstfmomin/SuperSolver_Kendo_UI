(function(a){function d(){var f=this;f.TotalFeedbacks=ko.observable("");f.Feedbacks=ko.observableArray();f.SelectedFeedback=ko.observable();f.MessageCount=ko.observable("");f.FeedbackMessages=ko.observableArray();f.Message=ko.observable();f.MailToLink1=ko.observable("");
f.MailToLink2=ko.observable("");}var b=SuperSolver.Loader,c=new d(),e=".Page";SuperSolver.MessageMain=function(){function k(){ko.applyBindings(c);l();g();h();i();j();f();}function l(){b.Show();a.get(SuperSolver.API+"/Feedbacks",function(q){if(q.Success){var r=q.Results;
c.TotalFeedbacks(r.length);c.Feedbacks(r);}else{alert(q.Msg);}}).complete(function(){b.Hide();});}function g(){a(".FeedbackList").on("click",".ResultRow",function(q){var t=q.target,s=a(t).parents(".ResultRow")[0],r=a(".Idx",s).val();n(r);});}function n(r){var q=c.Feedbacks()[r];
c.SelectedFeedback(q);m();}function m(){var q=c.SelectedFeedback();b.Show();a.get(SuperSolver.API+"/FeedbackMessages?ID="+q.SubmittedFeedbackID,function(s){if(s.Success){var t=s.Results,r=String.format(SuperSolver.ReplyToEmailTmpl,q.SubmittedFeedbackID);c.MessageCount(t.length);
c.FeedbackMessages(t);c.MailToLink1(String.format("mailto:{0}?Subject={1}",r,escape(t[0].Subject)));if(c.MessageCount()==1){o(0);}else{p("FeedbackMessages");}}else{alert(s.Msg);}}).complete(function(){b.Hide();});}function h(){a(".FeedbackMessageList").on("click",".ResultRow",function(q){var t=q.target,s=a(t).parents(".ResultRow")[0],r=a(".Idx",s).val();
o(r);});}function o(q){var r=c.FeedbackMessages()[q];b.Show();a.get(SuperSolver.API+"/Message?ID="+r.MessageID,function(u){if(u.Success){var t=u.Message,s=String.format(SuperSolver.ReplyToEmailTmpl,t.SubmittedFeedbackID);c.Message(t);c.MailToLink2(String.format("mailto:{0}?Subject={1}",s,escape(t.Subject)));
p("MessageView");}else{alert(u.Msg);}}).complete(function(){b.Hide();});}function p(q){a(e).hide();a('.Page[data-page="'+q+'"]').show();}function i(){a(".PrevBtn",'.Page[data-page="FeedbackMessages"]').click(function(){p("Feedbacks");});a(".PrevBtn",'.Page[data-page="MessageView"]').click(function(){if(c.MessageCount()==1){p("Feedbacks");
}else{p("FeedbackMessages");}});}function j(){a(".RefreshBtn",'.Page[data-page="Feedbacks"]').click(function(){l();});a(".RefreshBtn",'.Page[data-page="FeedbackMessages"]').click(function(){m();});}function f(){a(".DeleteBtn",'.Page[data-page="MessageView"]').click(function(){if(!confirm("Are you sure you would like to delete this message?")){return;
}var q=c.Message();a.post(SuperSolver.API+"/DeleteMessage",{ID:q.MessageID},function(r){if(r.Success){setTimeout(function(){l();p("Feedbacks");},300);}else{alert(r.Msg);}}).complete(function(){b.Hide();});});}return{Init:function(){k();}};}();})(jQuery);